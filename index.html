<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arabic-English-French Flashcards</title>
    <meta name="theme-color" content="#2196f3">
    <link rel="manifest" href="manifest.json">
    <!-- iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Flashcards">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #f9f9f9;
            font-family: 'Segoe UI', Arial, sans-serif;
            color: #222;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
        }
        body {
            min-height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0 70px 0;
        }
        h1 {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-size: 2.1rem;
            font-weight: 700;
            color: #1565c0;
            margin: 0 0 20px 0;
            letter-spacing: 1px;
            text-align: center;
        }
        .voices-select {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 14px;
        }
        .voices-select > div {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 6px rgba(44,62,80,0.06);
            padding: 8px 10px 6px 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-width: 120px;
        }
        .voices-select label {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }
        select {
            font-size: 1rem;
            padding: 7px 12px;
            border-radius: 8px;
            border: 1px solid #bdbdbd;
            margin-bottom: 4px;
            width: 100%;
        }
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 0 0 18px 0;
            position: sticky;
            top: 0;
            z-index: 2;
            background: #f9f9f9;
            padding: 8px 0 4px 0;
        }
        .controls button {
            font-size: 1.1rem;
            padding: 10px 18px;
            background: #2196f3;
            color: #fff;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(33,150,243,0.10);
            font-weight: 600;
            transition: background 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .controls button:active {
            background: #1976d2;
            box-shadow: 0 1px 4px rgba(33,150,243,0.12);
        }
        .flashcards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            justify-content: center;
            width: 100%;
            max-width: 1100px;
        }
        .flashcard {
            width: 100%;
            min-width: 200px;
            max-width: 320px;
            height: 170px;
            perspective: 1100px;
            cursor: pointer;
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(44,62,80,0.10), 0 1.5px 5px rgba(44,62,80,0.08);
            background: transparent;
            transition: box-shadow 0.2s;
        }
        .flashcard:active {
            box-shadow: 0 2px 8px rgba(33,150,243,0.14);
        }
        .flashcard-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(.4,2,.6,1);
            border-radius: 18px;
        }
        .flashcard-content {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 18px;
            box-sizing: border-box;
            font-size: 1.18rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-align: center;
            color: #34495e;
            border-radius: 18px;
            overflow: hidden;
            user-select: none;
        }
        .flashcard-front {
            background: linear-gradient(135deg, #e3f2fd 0%, #fff 100%);
        }
        .flashcard-middle {
            background: linear-gradient(135deg, #b3e5fc 0%, #e0f7fa 100%);
            transform: rotateY(-120deg);
        }
        .flashcard-back {
            background: linear-gradient(135deg, #b2dfdb 0%, #e0f2f1 100%);
            transform: rotateY(-240deg);
        }
        .custom-menu {
            display: none;
            position: absolute;
            z-index: 1000;
            background: #fff;
            border: 1px solid #ccc;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.18);
            padding: 10px 0;
            list-style: none;
            border-radius: 10px;
            min-width: 120px;
        }
        .custom-menu li {
            padding: 10px 18px;
            cursor: pointer;
            font-size: 1.08rem;
        }
        .custom-menu li:hover {
            background: #e3f2fd;
        }
        @media (max-width: 768px) {
            h1 {
                font-size: 1.45rem;
            }
            .flashcard {
                min-width: 160px;
                max-width: 220px;
                height: 120px;
            }
            .flashcard-content {
                font-size: 1.02rem;
                padding: 12px;
            }
            .voices-select > div {
                min-width: 90px;
            }
        }
        @media (max-width: 430px) {
            html, body {
                width: 100vw;
                min-width: 100vw;
                max-width: 100vw;
                overflow-x: hidden;
            }
            body {
                padding: 0 0 60px 0;
                min-height: 100vh;
            }
            .flashcards {
                grid-template-columns: 1fr;
                gap: 14px;
                padding: 0 6px;
            }
            .flashcard {
                min-width: 90vw;
                max-width: 95vw;
                height: 120px;
                margin: 0 auto;
            }
            .flashcard-content {
                font-size: 1.04rem;
                padding: 10px 4px;
            }
            h1 {
                font-size: 1.15rem;
                margin-bottom: 12px;
            }
            .controls {
                gap: 6px;
                padding: 6px 0 2px 0;
            }
            .controls button {
                font-size: 0.93rem;
                padding: 7px 8px;
                border-radius: 7px;
            }
            .voices-select label {
                font-size: 0.93rem;
            }
            .voices-select > div {
                min-width: 80px;
                padding: 5px 6px 4px 6px;
            }
        }
        /* Hide scrollbars on iOS */
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Arabic-English-French Flashcards</h1>
    <!-- (All your HTML content for voice selects, flashcards, controls, custom menu, etc.) -->
    <div class="voices-select">
        <div>
            <label for="arabicVoiceSelect">Arabic Voice:</label>
            <select id="arabicVoiceSelect"></select>
            <label>
                <input type="checkbox" id="arabicMute"> Mute
            </label>
        </div>
        <div>
            <label for="englishVoiceSelect">English Voice:</label>
            <select id="englishVoiceSelect"></select>
            <label>
                <input type="checkbox" id="englishMute"> Mute
            </label>
        </div>
        <div>
            <label for="frenchVoiceSelect">French Voice:</label>
            <select id="frenchVoiceSelect"></select>
            <label>
                <input type="checkbox" id="frenchMute"> Mute
            </label>
        </div>
    </div>
    <div class="controls">
        <button onclick="shuffleFlashcards()">Shuffle Flashcards</button>
        <button onclick="flipAllToArabic()">Flip All to Arabic</button>
        <button onclick="flipAllToEnglish()">Flip All to English</button>
        <button onclick="flipAllToFrench()">Flip All to French</button>
    </div>
    <div class="flashcards" id="flashcardsContainer">
        <!-- (All your flashcard HTML here) -->
        <!-- ... -->
        <div class="flashcard" id="flashcard-35" onclick="toggleFlipAndRead(this);" oncontextmenu="showCustomMenu(event, 35);">
            <div class="flashcard-inner" data-flip-state="arabic">
                <div class="flashcard-content flashcard-front">
                    <p>كدت أن أفقد وعيي عندما أخبروني بالسعر</p> <!-- Arabic (front) -->
                </div>
                <div class="flashcard-content flashcard-middle">
                    <p>I nearly fainted when they told me the price.</p> <!-- English (middle) -->
                </div>
                <div class="flashcard-content flashcard-back">
                    <p>Je me suis presque évanoui quand ils m'ont dit le prix.</p> <!-- French (back) -->
                </div>
            </div>
        </div>
        <div class="flashcard" id="flashcard-36" onclick="toggleFlipAndRead(this);" oncontextmenu="showCustomMenu(event, 36);">
            <div class="flashcard-inner" data-flip-state="arabic">
                <div class="flashcard-content flashcard-front">
                    <p>هذا غريب</p> <!-- Arabic (front) -->
                </div>
                <div class="flashcard-content flashcard-middle">
                    <p>That’s strange</p> <!-- English (middle) -->
                </div>
                <div class="flashcard-content flashcard-back">
                    <p>C'est étrange</p> <!-- French (back) -->
                </div>
            </div>
        </div>
        <div class="flashcard" id="flashcard-37" onclick="toggleFlipAndRead(this);" oncontextmenu="showCustomMenu(event, 37);">
            <div class="flashcard-inner" data-flip-state="arabic">
                <div class="flashcard-content flashcard-front">
                    <p>ازدحام ساعة الذروة</p> <!-- Arabic (front) -->
                </div>
                <div class="flashcard-content flashcard-middle">
                    <p>Rush hour traffic</p> <!-- English (middle) -->
                </div>
                <div class="flashcard-content flashcard-back">
                    <p>Embouteillages aux heures de pointe</p> <!-- French (back) -->
                </div>
            </div>
        </div>
    </div>
    <ul class="custom-menu" id="custom-menu">
        <li onclick="changeSelectedFlashcardColor('green')">Set to Green</li>
        <li onclick="changeSelectedFlashcardColor('red')">Set to Red</li>
        <li onclick="changeSelectedFlashcardColor('yellow')">Set to Yellow</li>
    </ul>
    <script>
        // Card flipping logic for mobile and desktop
        function toggleFlipAndRead(cardElem) {
            const inner = cardElem.querySelector('.flashcard-inner');
            let state = inner.getAttribute('data-flip-state');
            // Flip order: arabic -> english -> french -> arabic
            if (state === 'arabic') {
                inner.style.transform = 'rotateY(-120deg)';
                inner.setAttribute('data-flip-state', 'english');
                // Read English aloud if not muted
                const middle = inner.querySelector('.flashcard-middle p');
                if (middle) readAloud(middle.textContent, 'en');
            } else if (state === 'english') {
                inner.style.transform = 'rotateY(-240deg)';
                inner.setAttribute('data-flip-state', 'french');
                // Read French aloud if not muted
                const back = inner.querySelector('.flashcard-back p');
                if (back) readAloud(back.textContent, 'fr');
            } else {
                inner.style.transform = 'rotateY(0deg)';
                inner.setAttribute('data-flip-state', 'arabic');
                // Read Arabic aloud if not muted
                const front = inner.querySelector('.flashcard-front p');
                if (front) readAloud(front.textContent, 'ar');
            }
        }

        // --- Speech Synthesis with fallback and warning ---
        // Place a warning element at the top
        let speechWarning;
        window.addEventListener('DOMContentLoaded', function() {
            speechWarning = document.createElement('div');
            speechWarning.id = 'speech-warning';
            speechWarning.style.display = 'none';
            speechWarning.style.background = '#fff3cd';
            speechWarning.style.color = '#856404';
            speechWarning.style.padding = '10px 14px';
            speechWarning.style.fontSize = '1.05rem';
            speechWarning.style.margin = '0 0 10px 0';
            speechWarning.style.borderRadius = '8px';
            speechWarning.style.textAlign = 'center';
            speechWarning.style.border = '1px solid #ffeeba';
            document.body.insertBefore(speechWarning, document.body.firstChild);
        });

        function showSpeechWarning(msg) {
            if (speechWarning) {
                speechWarning.textContent = msg;
                speechWarning.style.display = 'block';
            }
        }
        function hideSpeechWarning() {
            if (speechWarning) speechWarning.style.display = 'none';
        }

        function readAloud(text, lang) {
            // Mute logic
            if ((lang === 'ar' && document.getElementById('arabicMute').checked) ||
                (lang === 'en' && document.getElementById('englishMute').checked) ||
                (lang === 'fr' && document.getElementById('frenchMute').checked)) {
                return;
            }
            if (!('speechSynthesis' in window)) {
                showSpeechWarning('Speech synthesis is not available on this device/browser.');
                return;
            }
            hideSpeechWarning();
            const synth = window.speechSynthesis;
            let voices = synth.getVoices();
            let voice = null;
            // Try to pick a matching voice
            if (voices && voices.length) {
                // Try to use the selected voice from the dropdown if available
                let selectId = lang === 'ar' ? 'arabicVoiceSelect' : lang === 'en' ? 'englishVoiceSelect' : 'frenchVoiceSelect';
                let select = document.getElementById(selectId);
                let selectedVoice = select && select.value;
                if (selectedVoice) {
                    voice = voices.find(v => v.voiceURI === selectedVoice);
                }
                // Fallback: pick the first matching language voice
                if (!voice) {
                    voice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith(lang));
                }
                // Fallback: pick the first available voice
                if (!voice && voices.length) {
                    voice = voices[0];
                }
            }
            if (!voice) {
                showSpeechWarning('No voice available for this language. Please check your device settings.');
                return;
            }
            hideSpeechWarning();
            try {
                let utter = new SpeechSynthesisUtterance(text);
                utter.voice = voice;
                utter.lang = voice.lang;
                utter.rate = 1;
                synth.cancel(); // Stop any previous speech
                synth.speak(utter);
            } catch (err) {
                showSpeechWarning('Speech synthesis failed: ' + err.message);
            }
        }

        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js');
          });
        }
    </script>
</body>
</html>
